# Транспортный справочник

*Данный проект был создан как тренировочный*
- Транспортный справочник хранит базу данных автобусов: номер автобусного маршрута, маршрут в виде названий и координат остановок, дорожные расстояния между остановками. После заполнения база сериализуется в указанный файл.
- Поддерживается получение информации о конкретной остановке или автобусе, отрисовка маршрута автобуса в формате svg и нахождение кратчайшего маршрута между заданными остановками.
- Для сборки проекта необходим CMake (минимальная версия 3.10) и Protobuf для поддержки сериализации. Путь к установленному пакету Protobuf нужно указать в префикс-пути CMake (CMAKE_PREFIX_PATH). 
- Программа работает в режиме заполнения базы автобусных маршрутов - "make_base", и в режиме обработки запросов к базе - "process_requests". Все данные подаются на вход программы в формате JSON. Примеры входных и выходных данных находятся в файлах *make_base_example.json*, *process_requests_example.json*, *output_example.json*.
  
  ## Запрос на заполнение справочника
  Запрос на заполнение справочника передаётся в программу в виде словаря с ключами:
  
  ### base_requests - массив с описанием автобусных маршрутов и остановок  
  + Описание остановки — словарь с ключами:
    + type — строка, равная "Stop". Означает, что словарь описывает остановку;
    + name — название остановки;
    + latitude и longitude — широта и долгота остановки — числа с плавающей запятой;
    + road_distances — словарь, задающий дорожное расстояние от этой остановки до соседних. Каждый ключ в этом словаре — название соседней остановки, значение — целочисленное расстояние в метрах.
  - Описание автобусного маршрута — словарь с ключами:
    - type — строка "Bus". Означает, что словарь описывает автобусный маршрут;
    - name — название маршрута;
    - stops — массив с названиями остановок, через которые проходит маршрут. У кольцевого маршрута название последней остановки дублирует название первой. Например: ["stop1", "stop2", "stop3", "stop1"];
    - is_roundtrip — значение типа bool. true, если маршрут кольцевой.

  ### render_settings - словарь с настройками отрисовки маршрутов
  - width и height — ширина и высота изображения в пикселях. Вещественное число в диапазоне от 0 до 100000;
  - padding — отступ краёв карты от границ SVG-документа. Вещественное число не меньше 0 и меньше min(width, height)/2;
  - line_width — толщина линий, которыми рисуются автобусные маршруты. Вещественное число в диапазоне от 0 до 100000;
  - stop_radius — радиус окружностей, которыми обозначаются остановки. Вещественное число в диапазоне от 0 до 100000;
  - bus_label_font_size — размер текста, которым написаны названия автобусных маршрутов. Целое число в диапазоне от 0 до 100000;
  - bus_label_offset — смещение надписи с названием маршрута относительно координат конечной остановки на карте. Массив из двух элементов типа double. Элементы массива — числа в диапазоне от –100000 до 100000;
  - stop_label_font_size — размер текста, которым отображаются названия остановок. Целое число в диапазоне от 0 до 100000;
  - stop_label_offset — смещение названия остановки относительно её координат на карте. Массив из двух элементов типа double. Числа в диапазоне от –100000 до 100000;
  - underlayer_color — цвет подложки под названиями остановок и маршрутов. Формат хранения цвета будет ниже;
  - underlayer_width — толщина подложки под названиями остановок и маршрутов. Вещественное число в диапазоне от 0 до 100000;
  - color_palette — цветовая палитра. Непустой массив.

    *Цвет может быть указан в виде строки с названием цвета, в формате RGB в виде в массива из трёх целых чисел диапазона [0, 255], или в формате RGBA в виде массива из четырёх элементов: трёх целых чисел в диапазоне от [0, 255] и одного вещественного числа в диапазоне от [0.0, 1.0].

  ### routing_settings - словарь с настройками маршрутизатора
  - bus_wait_time — время ожидания автобуса на остановке, в минутах. Значение — целое число от 1 до 1000;
  - bus_velocity — скорость автобуса, в км/ч. Время стоянки на остановках не учитывается, время разгона и торможения тоже. Значение — вещественное число от 1 до 1000.
 
  ### serialization_settings - словарь с настройками сериализации
  Содержит единственный ключ file, которому соответствует строка — название файла, в который нужно сохранить сериализованную базу.

  ## Обращения к справочнику
  Обращения к справочнику передаются в прорамму в виде словаря с ключами:
 
  ### stat_requests - массив с запросами информации об остановках и маршрутах
  - Каждый запрос — словарь с обязательными ключами id и type. Они задают уникальный числовой идентификатор запроса и его тип;
  - Для получения информации о маршруте используется ключ type со значением “Bus”. Ключ name задаёт название маршрута;
  - Для получения информации об остановке используется ключ type со значением “Stop”. Ключ name задаёт название остановки;
  - Запрос на отрисовку маршрутов в формате svg подаётся с помощью ключа type со значением "Map";
  - Запрос на построение маршрута между двумя остановками подаётся с помощью ключа type со значением "Route". Ключи from и to задают названия остановок, где нужно начать маршрут и где нужно его закончить.
 
  ### serialization_settings - словарь с настройками сериализации
  Содержит единственный ключ file, которому соответствует строка — название файла, из которого считывается сериализованная база.

  ## Ответ на запросы к справочнику
  Каждый ответ на запрос содержит request_id - id запроса.
  
  - Информация о маршруте автобуса содержит следующие сведения:
    - curvature — извилистость маршрута. Она равна отношению длины дорожного расстояния маршрута к длине географического расстояния;
    - route_length — длина дорожного расстояния маршрута в метрах, целое число;
    - stop_count — количество остановок на маршруте;
    - unique_stop_count — количество уникальных остановок на маршруте.
  - В ответ на запрос информации об остановке формируется список названий маршрутов, которые проходят через эту остановку;
  - В ответ на запрос отрисовки формируется строка с изображением карты в формате SVG;
  - Информация о кратчайшем маршруте содержит следующие сведения:
    - total_time — суммарное время в минутах, которое требуется для прохождения маршрута, выведенное в виде вещественного числа;
    - items — список элементов маршрута, каждый из которых описывает непрерывную активность пассажира, требующую временных затрат. А именно элементы маршрута бывают двух типов:
      - Wait — подождать нужное количество минут на указанной остановке;
      - Bus — проехать span_count остановок (перегонов между остановками) на автобусе bus, потратив указанное количество минут.
